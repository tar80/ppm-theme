var e,t,r,n;Object.keys||(Object.keys=(e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),n=(r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(u){if("function"!=typeof u&&("object"!=typeof u||null==u))throw new TypeError("Object.keys: called on non-object");var c,i,a=[];for(c in u)e.call(u,c)&&a.push(c);if(t)for(i=0;i<n;i++)e.call(u,r[i])&&a.push(r[i]);return a}));var u="jp",c="\r\n",i="K_ppmTemp",a=function(){return"cache\\"+PPx.Extract("%0").slice(3).replace(/\\/g,"@")},o=PPx.CreateObject("Scripting.FileSystemObject"),s=function(e){return""===e},l={TypeToCode:{crlf:"\r\n",cr:"\r",lf:"\n"},CodeToType:{"\r\n":"crlf","\r":"cr","\n":"lf"},Ppx:{lf:"%%bl",cr:"%%br",crlf:"%%bn",unix:"%%bl",mac:"%%br",dos:"%%bn","\n":"%%bl","\r":"%%br","\r\n":"%%bn"},Ascii:{lf:"10",cr:"13",crlf:"-1",unix:"10",mac:"13",dos:"-1","\n":"10","\r":"13","\r\n":"-1"}},x=function(e,t){try{var r;return[!1,null!=(r=t())?r:""]}catch(n){return[!0,""]}finally{e.Close()}},p=function(e){var t=e.path,r=e.enc,n=function(e){var t=e.path,r=e.enc,n=void 0===r?"utf8":r;if(!o.FileExists(t))return[!0,t+" not found"];var u=o.GetFile(t);if(0===u.Size)return[!0,t+" has no data"];var c=!1,i="";if("utf8"===n){var a=PPx.CreateObject("ADODB.Stream"),s=x(a,(function(){return a.Open(),a.Charset="UTF-8",a.LoadFromFile(t),a.ReadText(-1)}));c=s[0],i=s[1]}else{var l="utf16le"===n?-1:0,p=u.OpenAsTextStream(1,l),f=x(p,(function(){return p.ReadAll()}));c=f[0],i=f[1]}return c?[!0,"Unable to read "+t]:[!1,i]}({path:t,enc:void 0===r?"utf8":r}),u=n[0],c=n[1];if(u)return[!0,c];var i=function(e){var t="\n",r=e.indexOf("\r");return~r&&(t="\r\n"==e.substring(r,r+2)?"\r\n":"\r"),t}(c.slice(0,1e3)),a=c.split(i);return s(a[a.length-1])&&a.pop(),[!1,{lines:a,nl:i}]},f=function(e){var t=e.path,r=e.data,n=e.enc,u=void 0===n?"utf8":n,i=e.append,a=void 0!==i&&i,s=e.overwrite,p=void 0!==s&&s,f=e.linefeed,P=void 0===f?c:f;if(!p&&!a&&o.FileExists(t))return[!0,t+" already exists"];var d,v=o.GetParentFolderName(t);if(o.FolderExists(v)||PPx.Execute("*makedir "+v),"utf8"===u){if("ClearScriptV8"===PPx.ScriptEngineName){var m=r.join(P),E=a?"AppendAllText":"WriteAllText";return[!1,NETAPI.System.IO.File[E](t,m)]}var g=p||a?2:1,h=PPx.CreateObject("ADODB.Stream");d=x(h,(function(){h.Open(),h.Charset="UTF-8",h.LineSeparator=Number(l.Ascii[P]),a?(h.LoadFromFile(t),h.Position=h.Size,h.SetEOS):h.Position=0,h.WriteText(r.join(P),1),h.SaveToFile(t,g)}))[0]}else{var b=a?8:p?2:1,O="utf16le"===u?-1:0,C=o.GetFile(t).OpenAsTextStream(b,O);d=x(C,(function(){C.Write(r.join(P)+P)}))[0]}return d?[!0,"Could not write to "+t]:[!1,""]},P=/^([ABCEFHKMPSVX][BCEVTt]?_|_[CPSUWo]|Mes)/,d=function(e,t){if(0===t.indexOf("@")){if(t=PPx.Extract(t).substring(1),!o.FileExists(t))return 2}else if(!e.test(t))return 13;return 0},v=function(e,t,r){return void 0===t&&(t=""),t=s(t)?"":"/"+t,0===PPx.Execute('%"ppm'+t+'" %OC %'+e+'"'+r+'"')},m=function(){return"undefined"!=typeof ppm_test_run&&ppm_test_run<=2},E=function(e){return"."!==e},g={lang:u},h=function(e){var t=PPx.Extract("%*getcust(S_ppm#global:"+e+")");return g[e]=t,t},b="K_ppmTemp",O={echo:function(e,t,r){var n=r?"("+String(r)+")":"";return v("I",""+e,""+t+n)},question:function(e,t){return v("Q",""+e,t)},choice:function(e,t,r,n,u,c,i){void 0===n&&(n="ynC");var a="Mes0411",o=a+":IMYE",s=a+":IMNO",l=a+":IMTC",x="."===e,p=x?'%K"@LOADCUST"':'%%K"@LOADCUST"',f=[],P=f[0],d=f[1],v=f[2],m="",E="",g="",h=!1;u&&(P=PPx.Extract("%*getcust("+o+")"),m="*setcust "+o+"="+u+"%:",h=!0),c&&(d=PPx.Extract("%*getcust("+s+")"),E="*setcust "+s+"="+c+"%:",h=!0),i&&(v=PPx.Extract("%*getcust("+l+")"),g="*setcust "+l+"="+i+"%:",h=!0),h&&(PPx.Execute(""+m+E+g),O.execute(e,p));var b=x?"":e,C=PPx.Extract("%OCP %*extract("+b+'"%%*choice(-text""'+r+'"" -title:""'+t+'"" -type:'+n+')")');return h&&(P&&PPx.Execute("*setcust "+o+"="+P),d&&PPx.Execute("*setcust "+s+"="+d),v&&PPx.Execute("*setcust "+l+"= "+v),O.execute(e,p)),{0:"cancel",1:"yes",2:"no"}[C]},execute:function(e,t){return s(t)?1:m()?2===ppm_test_run&&PPx.Execute("*execute B,*linemessage %%bx1b[2F[Execute] "+e+",%("+t+"%)"):"tray"===e?PPx.Execute("*pptray -c "+t):E(e)?PPx.Execute("*execute "+e+","+t):PPx.Execute(t)},execSync:function(e,t){if(s(t))return 1;if(m())return 2===ppm_test_run&&PPx.Execute("*execute B,*linemessage %%bx1b[2F[Execute] "+e+",%("+t+"%)");if(1===e.length)e="b"+e;else if(0!==e.toUpperCase().indexOf("B"))return 6;return Number(PPx.Extract("%*extract("+e.toUpperCase()+',"'+t+'%%:%%*exitcode")'))},extract:function(e,t){if(s(t))return[13,""];var r=E(e)?PPx.Extract("%*extract("+e+',"'+t+'")'):PPx.Extract(t);return[Number(PPx.Extract()),r]},lang:function(){var e=g.lang;if(!s(e))return e;var t=PPx.Extract("%*getcust(S_ppm#global:lang)");return e="en"===t||"jp"===t?t:u,g.lang=e,e},global:function(e){var t,r,n=g[e];if(n)return n;if(/^ppm[ahrcl]?/.test(e)){if(n=PPx.Extract("%sgu'"+e+"'"),s(n)){var u=e.replace("ppm","");switch(u){case"":n=null!=(t=g.ppm)?t:PPx.Extract("%*getcust(S_ppm#global:ppm)");break;case"home":n=null!=(r=g.home)?r:PPx.Extract("%*getcust(S_ppm#global:home)");break;case"lib":var c;n=(null!=(c=g.ppm)?c:h("ppm"))+"\\dist\\lib";break;default:var i,o=null!=(i=g.home)?i:h("home");"cache"===u&&(n=o+"\\"+a())}}}else n=PPx.Extract("%*getcust(S_ppm#global:"+e+")");return g[e]=n,n},user:function(e){return PPx.Extract('%*extract("%%*getcust(S_ppm#user:'+e+')")')},setuser:function(e,t){return s(t)?1:PPx.Execute("*setcust S_ppm#user:"+e+"="+t)},getpath:function(e,t,r){void 0===r&&(r="");var n=d(/^[CXTDHLKBNPRVSU]+$/,e);if(0!==n)return[n,""];if(s(t))return[1,""];var u=s(r)?"":',"'+r+'"',c=PPx.Extract("%*name("+e+',"'+t+'"'+u+")");return[n=Number(PPx.Extract()),c]},getcust:function(e){if(s(e))return[1,""];var t=d(P,e);if(0!==t)return[t,""];var r=PPx.Extract("%*getcust("+e+")");return[t=Number(PPx.Extract()),r]},setcust:function(e,t){if(void 0===t&&(t=!1),s(e))return 1;var r=d(P,e);if(0!==r)return r;var n=t?"%OC ":"";return PPx.Execute(n+"*setcust "+e)},deletecust:function(e,t,r){var n="boolean"==typeof t,u=/^\s*"?([^"\s]+)"?\s*?$/,c=e.replace(u,"$1"),i=String(t),a=d(P,c);if(0!==a)return a;var o=null==t||n||s(i)?'"'+c+'"':c+","+("string"==typeof t?'"'+t.replace(u,"$1")+'"':""+t);return PPx.Execute("*deletecust "+o),r&&PPx.Execute('%K"loadcust"'),0},setkey:function(e,t,r){if(void 0===r&&(r=!1),s(e))throw new Error("SubId is empty");var n=r?"%OC ":"";return PPx.Execute(n+"*setcust "+i+":"+e+","+t),i},deletekeys:function(){PPx.Execute('*deletecust "'+i+'"')},linecust:function(e){var t=e.label,r=e.id,n=e.sep,u=void 0===n?"=":n,c=e.value,i=void 0===c?"":c,a=e.esc,o=void 0!==a&&a,l=e.once,x=void 0!==l&&l?"*linecust "+t+","+r+",%%:":"";!s(i)&&o&&(i="%("+i+"%)"),PPx.Execute("*linecust "+t+","+r+u+x+i)},getvalue:function(e,t,r){if(s(r))return[1,""];var n=E(e)?PPx.Extract("%*extract("+e+',"%%s'+t+"'"+r+"'\")"):PPx.Extract("%s"+t+"'"+r+"'");return[s(n)?13:0,n]},setvalue:function(e,t,r,n){return s(r)?1:E(e)?PPx.Execute("*execute "+e+",*string "+t+","+r+"="+n):PPx.Execute("*string "+t+","+r+"="+n)},getinput:function(e){var t,r=e.message,n=void 0===r?"":r,u=e.title,c=void 0===u?"":u,i=e.mode,a=void 0===i?"g":i,o=e.select,s=void 0===o?"a":o,l=e.multi,x=void 0!==l&&l,p=e.leavecancel,f=void 0!==p&&p,P=e.forpath,v=void 0!==P&&P,m=e.fordijit,E=void 0!==m&&m,g=e.autoselect,h=void 0!==g&&g,O=e.k,C=void 0===O?"":O,S=x?" -multi":"",y=f?" -leavecancel":"",N=v?" -forpath":"",T=E?" -fordijit":"";h&&(t=C,PPx.Execute("%OC *setcust "+b+':ENTER,*if -1==%%*sendmessage(%%N-L,392,0,0)%%:%%K"@DOWN"%bn%bt%%K"@ENTER"'),PPx.Execute("%OC *setcust "+b+':\\ENTER,*if -1==%%*sendmessage(%%N-L,392,0,0)%%:%%K"@DOWN"%bn%bt%%K"@ENTER"'),C="*mapkey use,"+b+"%%:"+t);var R=""!==C?" -k %%OP- "+C:"",_=d(/^[gnmshdcfuxeREOUX][gnmshdcfuxeSUX,]*$/,a);if(0!==_)return[_,""];var w=PPx.Extract('%OCP %*input("'+n+'" -title:"'+c+'" -mode:'+a+" -select:"+s+S+y+N+T+R+")");return _=Number(PPx.Extract()),h&&PPx.Execute('*deletecust "'+b+'"'),[_,w]},linemessage:function(e,t,r,n){var u,c="B"===PPx.Extract("%n").substring(0,1);if("object"==typeof t){var i=n?"%%bn":" ";u=t.join(i)}else u=t;e="."===e?"":e,u=r&&!c?'!"'+u:u,PPx.Execute("%OC *execute "+e+",*linemessage "+u)},report:function(e){var t="string"==typeof e?e:e.join(c);0===PPx.Extract("%n").indexOf("B")?PPx.linemessage(t):PPx.report(t)},close:function(e){PPx.Execute("*closeppx "+e)},jobstart:function(e){return O.execute(e,"*job start"),function(){return O.execute(e,"*job end")}}},C=/^(BACKGROUND|FOREGROUND|CURSORCOLOR|SELECTIONBACKGROUND|BRIGHT)/,S=/^#[0-9a-zA-Z]{6}$/,y=/^#(..)(..)(..)$/,N=function(e,t){if(S.test(t)){var r=t.replace(y,"$3;$2;$1").split(";"),n=function(e,t){var r="yes"!==e;return function(e,n){var u=parseInt(e,16),c=parseInt(n,16),i=r?u-(u-c)*t:u+(c-u)*t;return("0"+Math.floor(i).toString(16)).slice(-2)}}(e,.4);return function(e){if(S.test(e)){var t=e.replace(y,"$3;$2;$1").split(";");return("H"+n(r[0],t[0])+n(r[1],t[1])+n(r[2],t[2])).toUpperCase()}}}},T=function(e){return e.replace(C,(function(e){return{BACKGROUND:"BG",FOREGROUND:"FG",CURSORCOLOR:"CURSOR",SELECTIONBACKGROUND:"SELECTION",BRIGHT:"B"}[e]}))},R=function(e){if(e=e.toUpperCase(),S.test(e))return e.replace(y,"H$3$2$1")},_=function(){var e,t,r=PPx.ScriptName;return~r.indexOf("\\")?(e=r.replace(/^.*\\/,""),t=PPx.Extract("%*name(DKN,"+r+")")):(e=r,t=PPx.Extract("%FDN")),{scriptName:e,parentDir:t.replace(/\\$/,"")}}(),w=_.parentDir,F={en:{couldNotGet:"Could not get theme json",question:"Apply theme colors",yes:"&Dark bg",no:"&Light bg",failedToGetName:"Could not get theme name",failedReplace:"Failed replace",finish:"completed"},jp:{couldNotGet:"テーマ設定ファイルを取得できませんでした",question:"テーマカラーを適用します",yes:"黒背景(&D)",no:"白背景(&L)",failedToGetName:"テーマ名を取得できませんでした",failedReplace:"置換に失敗しました",finish:"完了"}}[function(){var e=PPx.Extract("%*getcust(S_ppm#global:lang)");return"en"===e||"jp"===e?e:u}()],j=function(e){void 0===e&&(e=PPx.Arguments);for(var t=["iceberg-dark",undefined],r=0,n=e.length;r<n;r++)t[r]=e.Item(r);return t[1]&&(t[1]=/^(yes|no)$/.test(t[1])?t[1]:"yes"),{fileName:t[0],hasMode:t[1]}},A=function(e){var t=w.replace(/^(.+)\\dist/,"$1")+"\\themes\\windowsterminal"+"\\"+e+".json";if(!o.FileExists(t)){var r=o.GetParentFolderName(t),n=o.GetFileName(t),u=/[_-]/g;if(t=r+"\\"+n.replace(u," "),!o.FileExists(t)&&(t=r+"\\"+n.replace(u,""),!o.FileExists(t)))return[!1,F.couldNotGet]}return[!0,t]},U=function(){for(var e=PPx.Extract("%*ppxlist(-)").split(","),t=0;t<e.length;t++){var r=e[t];~r.indexOf("_")&&O.execute(r,'%%K"@LOADCUST')}};!function(){var e=j(),t=e.fileName,r=e.hasMode,n=A(t),u=n[0],c=n[1];u||O.linemessage(".",c,!0);var i=null!=r?r:O.choice(".","ppm-theme",F.question+" -> "+t,"Ync",F.yes,F.no);"cancel"===i&&PPx.Quit(1);var a=p({path:c}),o=a[0],l=a[1];if(function(e,t){return e&&"string"==typeof t}(o,l))throw new Error(l);var x=function(e,t){for(var r="",n=["A_color\t= {"],u={},c=/^\s*"([^"]+)": "([^"]+)",?$/,i=1,a=t.length-1;i<a;i++){var o=t[i];if(~o.indexOf('"name":'))r=o.replace(c,"$2");else{var s=o.replace(c,"$1;$2").split(";"),l=s[0],x=s[1];u[l=l.toUpperCase()]=x;var p=R(x);if(!p)throw new Error("An invalid color was detected. "+r+": "+x);n.push(T(l)+"\t= "+p)}}if(!u.BACKGROUND)throw new Error("Could not get the "+r+" background color.");var f=N(e,u.BACKGROUND);if(!f)throw new Error(r+" background color shows invalid value");for(var P=0,d=Object.keys(u);P<d.length;P++){var v=d[P];if(!C.test(v)){if(!f(u[v]))throw new Error(r+" "+v+" shows invalid value");n.push("S"+v+"\t= "+f(u[v]))}}return n.push("}"),[r,n]}(i,l.lines),P=x[0],d=x[1];if(s(P))throw new Error(F.failedToGetName);var v,m=(v=PPx.Extract('%*extract(C,"%%*temp()")'),{dir:v,file:v+"_ppmtemp",stdout:v+"_stdout",stderr:v+"_stderr",ppmDir:function(){var e=PPx.Extract("%'temp'%\\ppm");return PPx.Execute("*makedir "+e),e}}).file,E=f({path:m,data:d,overwrite:!0,linefeed:"\n"});if(o=E[0],l=E[1],o)throw new Error(l);var g="yes"===i?"0":"-3",h=O.getcust("X_uxt")[1].replace(/^.+,/,"");"1"===O.user("th_automode")&&O.setcust("X_uxt="+g+","+h),O.setuser("th_name",P),O.setcust('@%sgu"ppmcache"\\ppm\\unset\\ppm-theme.cfg'),O.setcust("@"+m),O.setcust('@%sgu"ppmcache"\\ppm\\setup\\ppm-theme.cfg'),U(),!r&&O.linemessage(".",F.finish,!0)}();
